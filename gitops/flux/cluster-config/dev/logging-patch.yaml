apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: elasticsearch
  namespace: logging
spec:
  values:
    replicas: 1
    resources:
      requests:
        cpu: 100m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1Gi
    # Completely disable security for dev environment
    secret:
      enabled: false
    protocol: http
    esConfig:
      elasticsearch.yml: |
        xpack.security.enabled: false
    # Override readiness probe to not require password
    readinessProbe:
      httpGet:
        path: /_cluster/health?wait_for_status=green&timeout=1s
        port: 9200
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      successThreshold: 3
      failureThreshold: 3
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: kibana
  namespace: logging
spec:
  values:
    service:
      type: ClusterIP
    resources:
      requests:
        cpu: 50m
        memory: 256Mi
      limits:
        cpu: 200m
        memory: 512Mi
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: fluent-bit
  namespace: logging
spec:
  values:
    serviceAccount:
      create: true
    outputs: |
      [OUTPUT]
          Name  es
          Match *
          Host  elasticsearch-master.logging.svc.cluster.local
          Port  9200
          Index fluent-bit
          Logstash_Format On
