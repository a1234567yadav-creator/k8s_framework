name: Platform Sync (stubs)

on:
  push:
    branches:
      - main

jobs:
  sync-dev:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Azure login
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE }}

      - name: Pull AKS kubeconfig
        run: az aks get-credentials -g hub -n k8s-framework --overwrite-existing

      - name: Install Flux CLI
        run: |
          curl -s https://fluxcd.io/install.sh | sudo bash
          flux --version

      - name: Reconcile Flux for dev
        run: |
          echo "Triggering Flux reconciliation for dev environment..."
          flux reconcile kustomization platform-dev --with-source
          
          echo "âœ… Dev environment sync triggered"

  # Uncomment for stage/prod when ready
  # sync-stage:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v4
  #     
  #     - name: Azure login
  #       uses: azure/login@v2
  #       with:
  #         creds: ${{ secrets.AZURE_STAGE }}
  #     
  #     - name: Pull AKS kubeconfig
  #       run: az aks get-credentials -g <resource-group> -n <cluster-name> --overwrite-existing
  #     
  #     - name: Install Flux CLI
  #       run: curl -s https://fluxcd.io/install.sh | sudo bash
  #     
  #     - name: Reconcile Flux for stage
  #       run: flux reconcile kustomization platform-stage --with-source
