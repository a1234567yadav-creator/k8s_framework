# Backstage development environment configuration
# Optimized for 4-core constraint

# Disable PostgreSQL dependency and use SQLite for development
postgresql:
  enabled: false

backstage:
  resources:
    requests:
      cpu: 100m     # Reduced for dev
      memory: 256Mi
    limits:
      cpu: 300m
      memory: 512Mi
  
  # Dev-specific environment variables
  extraEnvVars:
    - name: NODE_ENV
      value: "development"
    - name: LOG_LEVEL
      value: "debug"
    
    # Platform integration URLs
    - name: PROMETHEUS_URL
      value: "http://kube-prometheus-stack-prometheus.monitoring.svc.cluster.local:9090"
    - name: GRAFANA_URL  
      value: "http://kube-prometheus-stack-grafana.monitoring.svc.cluster.local"
    - name: GRAFANA_EXTERNAL_URL
      value: "http://4.187.230.65/grafana"  # Using ingress external IP
      
    # Kubernetes cluster info
    - name: KUBERNETES_CLUSTER_NAME
      value: "k8s-framework-dev"
    - name: KUBERNETES_CLUSTER_URL
      value: "https://kubernetes.default.svc"
      
    # GitHub integration (placeholder)
    - name: GITHUB_TOKEN
      value: "placeholder-for-github-token"
    - name: BACKSTAGE_BASE_URL
      value: "http://backstage.dev.k8s-framework.local"

  # Additional configuration for dev
  appConfig:
    app:
      title: "K8s Framework Developer Portal"
      baseUrl: "http://backstage.dev.k8s-framework.local"
    
    backend:
      baseUrl: "http://backstage.dev.k8s-framework.local"
      cors:
        origin: "http://backstage.dev.k8s-framework.local"
      database:
        client: better-sqlite3
        connection: ':memory:'  # Use in-memory SQLite for development
    
    kubernetes:
      serviceLocatorMethod:
        type: 'multiTenant'
      clusterLocatorMethods:
        - type: 'config'
          clusters:
            - url: 'https://kubernetes.default.svc'
              name: k8s-framework-dev
              authProvider: 'serviceAccount'
              skipTLSVerify: true