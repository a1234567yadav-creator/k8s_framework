# Backstage development environment configuration
# Integrated with K8s platform services

# Disable PostgreSQL dependency and use SQLite for development
postgresql:
  enabled: false

# Service Account for Kubernetes access
serviceAccount:
  create: false
  name: backstage

backstage:
  resources: {}  # No resource constraints
  
  # Platform integrations
  appConfig:
    app:
      title: K8s Platform Portal
      baseUrl: http://localhost:7007
    
    organization:
      name: Platform Team
    
    backend:
      baseUrl: http://localhost:7007
      listen:
        port: 7007
      cors:
        origin: http://localhost:7007
      database:
        client: better-sqlite3
        connection: ':memory:'
    
    # Kubernetes integration
    kubernetes:
      serviceLocatorMethod:
        type: 'multiTenant'
      clusterLocatorMethods:
        - type: 'config'
          clusters:
            - url: https://kubernetes.default.svc
              name: dev-cluster
              authProvider: 'serviceAccount'
              skipTLSVerify: false
    
    # Prometheus integration
    prometheus:
      proxyUrl: http://kube-prometheus-stack-prometheus.monitoring.svc:9090
    
    # Grafana integration  
    grafana:
      domain: http://grafana.monitoring.svc
      unifiedAlerting: true

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  host: backstage.dev.example.com
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    - name: LOG_LEVEL
      value: "debug"
    
    # Platform integration URLs
    - name: PROMETHEUS_URL
      value: "http://kube-prometheus-stack-prometheus.monitoring.svc.cluster.local:9090"
    - name: GRAFANA_URL  
      value: "http://kube-prometheus-stack-grafana.monitoring.svc.cluster.local"
    - name: GRAFANA_EXTERNAL_URL
      value: "http://4.187.230.65/grafana"  # Using ingress external IP
      
    # Kubernetes cluster info
    - name: KUBERNETES_CLUSTER_NAME
      value: "k8s-framework-dev"
    - name: KUBERNETES_CLUSTER_URL
      value: "https://kubernetes.default.svc"
      
    # GitHub integration (placeholder)
    - name: GITHUB_TOKEN
      value: "placeholder-for-github-token"
    - name: BACKSTAGE_BASE_URL
      value: "http://backstage.dev.k8s-framework.local"

  # Additional configuration for dev
  appConfig:
    app:
      title: "K8s Framework Developer Portal"
      baseUrl: "http://backstage.dev.k8s-framework.local"
    
    backend:
      baseUrl: "http://backstage.dev.k8s-framework.local"
      cors:
        origin: "http://backstage.dev.k8s-framework.local"
      database:
        client: better-sqlite3
        connection: ':memory:'  # Use in-memory SQLite for development
    
    kubernetes:
      serviceLocatorMethod:
        type: 'multiTenant'
      clusterLocatorMethods:
        - type: 'config'
          clusters:
            - url: 'https://kubernetes.default.svc'
              name: k8s-framework-dev
              authProvider: 'serviceAccount'
              skipTLSVerify: true